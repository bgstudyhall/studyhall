<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyHall Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-tertiary: #f3f4f6;
            --bg-hover: #f3f4f6;
            --border-color: #e5e7eb;
            --border-dark: #d1d5db;
            --text-primary: #111827;
            --text-secondary: #4b5563;
            --text-tertiary: #6b7280;
            --text-muted: #9ca3af;
            --accent-blue: #2563eb;
            --accent-blue-hover: #1d4ed8;
            --accent-green: #059669;
            --accent-red: #dc2626;
            --accent-yellow: #d97706;
            --accent-purple: #7c3aed;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 260px;
            background: var(--bg-primary);
            border-right: 1px solid var(--border-color);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            display: flex;
            flex-direction: column;
            z-index: 100;
        }
        .sidebar-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        .sidebar-logo {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .sidebar-logo span {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .sidebar-user {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .sidebar-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1rem;
        }
        .sidebar-user-info { flex: 1; min-width: 0; }
        .sidebar-user-name {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .sidebar-user-role {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        .role-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.125rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        .role-admin { background: #fef2f2; color: #dc2626; }
        .role-president { background: #f3e8ff; color: #7c3aed; }
        .role-economy_director { background: #fef3c7; color: #d97706; }
        .role-pr_director { background: #dbeafe; color: #2563eb; }
        .role-master_moderator { background: #fee2e2; color: #dc2626; }
        .role-ambassador { background: #d1fae5; color: #059669; }
        .sidebar-nav {
            flex: 1;
            overflow-y: auto;
            padding: 1rem 0;
        }
        .nav-section { margin-bottom: 1.5rem; }
        .nav-section-title {
            padding: 0.5rem 1.5rem;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 1.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }
        .nav-item:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        .nav-item.active {
            background: var(--bg-tertiary);
            color: var(--accent-blue);
        }
        .nav-item-icon { width: 20px; text-align: center; font-size: 1rem; }
        .nav-item-badge {
            margin-left: auto;
            background: var(--accent-red);
            color: white;
            font-size: 0.65rem;
            font-weight: 700;
            padding: 0.125rem 0.4rem;
            border-radius: 9999px;
            min-width: 18px;
            text-align: center;
        }
        .sidebar-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border-color);
        }
        .sidebar-footer a {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-tertiary);
            text-decoration: none;
            font-size: 0.875rem;
            font-weight: 500;
        }
        .sidebar-footer a:hover { color: var(--text-primary); }
        .main-content {
            margin-left: 260px;
            flex: 1;
            min-height: 100vh;
            padding: 2rem;
        }
        .page-header { margin-bottom: 2rem; }
        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }
        .page-description {
            font-size: 0.875rem;
            color: var(--text-tertiary);
        }
        .card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            margin-bottom: 1.5rem;
        }
        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .card-title { font-size: 1rem; font-weight: 600; color: var(--text-primary); }
        .card-body { padding: 1.5rem; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.25rem;
            box-shadow: var(--shadow-sm);
        }
        .stat-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }
        .stat-value { font-size: 1.75rem; font-weight: 700; color: var(--text-primary); }
        .form-group { margin-bottom: 1.25rem; }
        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.625rem 0.875rem;
            font-size: 0.875rem;
            font-family: inherit;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.15s;
        }
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        .form-input::placeholder { color: var(--text-muted); }
        .form-textarea { min-height: 100px; resize: vertical; }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.625rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            font-family: inherit;
            border-radius: var(--radius-md);
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.15s;
            text-decoration: none;
        }
        .btn-primary { background: var(--accent-blue); color: white; }
        .btn-primary:hover { background: var(--accent-blue-hover); }
        .btn-secondary {
            background: var(--bg-primary);
            color: var(--text-secondary);
            border-color: var(--border-color);
        }
        .btn-secondary:hover { background: var(--bg-hover); color: var(--text-primary); }
        .btn-danger { background: var(--accent-red); color: white; }
        .btn-danger:hover { background: #b91c1c; }
        .btn-success { background: var(--accent-green); color: white; }
        .btn-success:hover { background: #047857; }
        .btn-warning { background: var(--accent-yellow); color: white; }
        .btn-sm { padding: 0.375rem 0.75rem; font-size: 0.8rem; }
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th {
            text-align: left;
            padding: 0.75rem 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }
        .data-table td {
            padding: 0.875rem 1rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border-color);
        }
        .data-table tr:hover td { background: var(--bg-hover); }
        .data-table tr:last-child td { border-bottom: none; }
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.625rem;
            font-size: 0.7rem;
            font-weight: 600;
            border-radius: 9999px;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }
        .badge-success { background: #d1fae5; color: #059669; }
        .badge-danger { background: #fee2e2; color: #dc2626; }
        .badge-warning { background: #fef3c7; color: #d97706; }
        .badge-info { background: #dbeafe; color: #2563eb; }
        .badge-purple { background: #f3e8ff; color: #7c3aed; }
        .badge-gray { background: #f3f4f6; color: #6b7280; }
        .section { display: none; }
        .section.active { display: block; }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 480px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-md);
        }
        .modal-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .modal-title { font-size: 1.125rem; font-weight: 600; }
        .modal-close {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: var(--text-tertiary);
            cursor: pointer;
            padding: 0.25rem;
            line-height: 1;
        }
        .modal-close:hover { color: var(--text-primary); }
        .modal-body { padding: 1.5rem; }
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }
        .search-box { position: relative; max-width: 300px; }
        .search-box input {
            width: 100%;
            padding: 0.5rem 0.875rem 0.5rem 2.25rem;
            font-size: 0.875rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-primary);
        }
        .search-box input:focus { outline: none; border-color: var(--accent-blue); }
        .search-box::before {
            content: 'üîç';
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.75rem;
        }
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }
        .item-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.25rem;
            transition: all 0.15s;
        }
        .item-card:hover { box-shadow: var(--shadow-md); border-color: var(--border-dark); }
        .item-card-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }
        .item-card-title { font-weight: 600; color: var(--text-primary); font-size: 0.95rem; }
        .item-card-meta { font-size: 0.8rem; color: var(--text-tertiary); margin-bottom: 1rem; }
        .item-card-actions { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .toggle-switch { position: relative; width: 44px; height: 24px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg-tertiary);
            border-radius: 24px;
            transition: 0.3s;
            border: 1px solid var(--border-color);
        }
        .toggle-slider:before {
            content: '';
            position: absolute;
            height: 18px; width: 18px;
            left: 2px; bottom: 2px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
            box-shadow: var(--shadow-sm);
        }
        .toggle-switch input:checked + .toggle-slider {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
        }
        .toggle-switch input:checked + .toggle-slider:before { transform: translateX(20px); }
        .empty-state { text-align: center; padding: 3rem 2rem; color: var(--text-tertiary); }
        .empty-state-icon { font-size: 3rem; margin-bottom: 1rem; opacity: 0.5; }
        .empty-state-title { font-size: 1rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem; }
        .alert {
            padding: 1rem 1.25rem;
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }
        .alert-info { background: #eff6ff; color: #1e40af; border: 1px solid #bfdbfe; }
        .alert-success { background: #ecfdf5; color: #065f46; border: 1px solid #a7f3d0; }
        .alert-warning { background: #fffbeb; color: #92400e; border: 1px solid #fcd34d; }
        .alert-danger { background: #fef2f2; color: #991b1b; border: 1px solid #fecaca; }
        .report-item {
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: var(--bg-primary);
        }
        .report-item:hover { border-color: var(--border-dark); }
        .report-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }
        .report-content {
            background: var(--bg-secondary);
            padding: 0.75rem;
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            margin-bottom: 0.75rem;
            border-left: 3px solid var(--accent-yellow);
        }
        .report-meta {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .report-actions { display: flex; gap: 0.5rem; margin-top: 0.75rem; }
        .paycheck-card {
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1.25rem;
            margin-bottom: 0.75rem;
            background: var(--bg-primary);
        }
        .paycheck-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }
        .paycheck-amount { font-size: 1.5rem; font-weight: 700; color: var(--accent-green); }
        .paycheck-adjustment {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
        }
        .paycheck-adjustment.positive { background: #d1fae5; color: #059669; }
        .paycheck-adjustment.negative { background: #fee2e2; color: #dc2626; }
        .log-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 0.875rem 0;
            border-bottom: 1px solid var(--border-color);
        }
        .log-item:last-child { border-bottom: none; }
        .log-icon {
            width: 32px; height: 32px;
            border-radius: 50%;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            flex-shrink: 0;
        }
        .log-content { flex: 1; min-width: 0; }
        .log-action { font-size: 0.875rem; color: var(--text-primary); margin-bottom: 0.25rem; }
        .log-action strong { font-weight: 600; }
        .log-time { font-size: 0.75rem; color: var(--text-muted); }
        .log-reason {
            font-size: 0.8rem;
            color: var(--text-tertiary);
            background: var(--bg-secondary);
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            margin-top: 0.5rem;
        }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .mt-3 { margin-top: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .text-muted { color: var(--text-muted); }
        .text-success { color: var(--accent-green); }
        .text-danger { color: var(--accent-red); }
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); transition: transform 0.3s; }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-left: 0; padding: 1rem; }
            .stats-grid { grid-template-columns: 1fr 1fr; }
            .items-grid { grid-template-columns: 1fr; }
        }
        .logo-img {
    height: 1.5em; /* Scales with your font size */
    width: auto;
}
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
    <img src="https://i.ibb.co/FkwcDYxs/IMG-1951.png" alt="Logo" class="logo-img">
    <span>StudyHall</span>Panel
</div>

        </div>
        <div class="sidebar-user">
            <div class="sidebar-user-avatar">{{ session.username[0].upper() }}</div>
            <div class="sidebar-user-info">
                <div class="sidebar-user-name">{{ session.username }}</div>
                <div class="sidebar-user-role">
                    <span class="role-badge role-{{ user_role }}">
                        {{ STAFF_ROLES[user_role].icon }} {{ STAFF_ROLES[user_role].name }}
                    </span>
                </div>
            </div>
        </div>
        <nav class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-section-title">Overview</div>
                <button class="nav-item active" onclick="showSection('dashboard', this)">
                    <span class="nav-item-icon">‚Üí</span> Dashboard
                </button>
            </div>
            {% if user_permissions.create_users or user_permissions.ban_users %}
            <div class="nav-section">
                <div class="nav-section-title">User Management</div>
                {% if user_permissions.create_users %}
                <button class="nav-item" onclick="showSection('create-user', this)">
                    <span class="nav-item-icon">‚ûï</span> Create User
                </button>
                {% endif %}
                {% if user_permissions.ban_users or user_permissions.change_passwords %}
                <button class="nav-item" onclick="showSection('manage-users', this)">
                    <span class="nav-item-icon">‚Üí</span> Manage Users
                </button>
                {% endif %}
                {% if user_permissions.assign_roles %}
                <button class="nav-item" onclick="showSection('assign-roles', this)">
                    <span class="nav-item-icon">‚ÜíÔ∏è</span> Assign Roles
                </button>
                {% endif %}
            </div>
            {% endif %}
            {% if user_permissions.manage_games or user_permissions.manage_announcements or user_permissions.manage_groups %}
            <div class="nav-section">
                <div class="nav-section-title">Content</div>
                {% if user_permissions.manage_games %}
                <button class="nav-item" onclick="showSection('games', this)">
                    <span class="nav-item-icon">‚Üí</span> Games
                </button>
                {% endif %}
                {% if user_permissions.manage_announcements %}
                <button class="nav-item" onclick="showSection('announcements', this)">
                    <span class="nav-item-icon">‚Üí</span> Announcements
                </button>
                {% endif %}
                {% if user_permissions.manage_groups %}
                <button class="nav-item" onclick="showSection('groups', this)">
                    <span class="nav-item-icon">‚Üí</span> Groups
                </button>
                {% endif %}
            </div>
            {% endif %}
            {% if user_permissions.view_token_stats or user_permissions.manage_lottery or user_permissions.create_promo_codes %}
            <div class="nav-section">
                <div class="nav-section-title">Economy</div>
                {% if user_permissions.view_token_stats %}
                <button class="nav-item" onclick="showSection('token-stats', this)">
                    <span class="nav-item-icon">‚Üí</span> Token Stats
                </button>
                <button class="nav-item" onclick="showSection('casino-stats', this)">
                    <span class="nav-item-icon">‚Üí</span> Casino Stats
                </button>
                {% endif %}
                {% if user_permissions.create_promo_codes %}
                <button class="nav-item" onclick="showSection('promo-codes', this)">
                    <span class="nav-item-icon">‚Üí</span> Promo Codes
                </button>
                {% endif %}
                {% if user_permissions.manage_lottery %}
                <button class="nav-item" onclick="showSection('lottery', this)">
                    <span class="nav-item-icon">‚ÜíÔ∏è</span> Lottery
                </button>
                {% endif %}
            </div>
            {% endif %}
            {% if user_permissions.view_reported_messages %}
            <div class="nav-section">
                <div class="nav-section-title">Moderation</div>
                <button class="nav-item" onclick="showSection('reports', this)">
                    <span class="nav-item-icon">‚Üí</span> Reports
                    {% if pending_reports > 0 %}<span class="nav-item-badge">{{ pending_reports }}</span>{% endif %}
                </button>
            </div>
            {% endif %}
            {% if user_permissions.manage_feedback %}
            <div class="nav-section">
                <div class="nav-section-title">Public Relations</div>
                <button class="nav-item" onclick="showSection('feedback', this)">
                    <span class="nav-item-icon">‚Üí</span> Feedback
                    {% if feedback|length > 0 %}<span class="nav-item-badge">{{ feedback|length }}</span>{% endif %}
                </button>
            </div>
            {% endif %}
            {% if user_permissions.view_paycheck_status %}
            <div class="nav-section">
                <div class="nav-section-title">Payroll</div>
                <button class="nav-item" onclick="showSection('paychecks', this)">
                    <span class="nav-item-icon"></span> Paychecks
                    {% if pending_paychecks > 0 and user_permissions.approve_paychecks %}<span class="nav-item-badge">{{ pending_paychecks }}</span>{% endif %}
                </button>
            </div>
            {% endif %}
            {% if user_permissions.maintenance_mode or user_permissions.view_action_logs %}
            <div class="nav-section">
                <div class="nav-section-title">System</div>
                {% if user_permissions.view_action_logs %}
                <button class="nav-item" onclick="showSection('action-logs', this)">
                    <span class="nav-item-icon"></span> Action Logs
                </button>
                {% endif %}
                {% if user_permissions.maintenance_mode %}
                <button class="nav-item" onclick="showSection('maintenance', this)">
                    <span class="nav-item-icon"></span> Maintenance
                </button>
                {% endif %}
            </div>
            {% endif %}
        </nav>
        <div class="sidebar-footer">
            <a href="{{ url_for('index') }}">‚Üê Back to Site</a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard -->
        <section id="dashboard-section" class="section active">
            <div class="page-header">
                <h1 class="page-title">Dashboard</h1>
                <p class="page-description">Welcome back, {{ session.username }}.</p>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total BG Students</div>
                    <div class="stat-value">{{ users|length }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Games</div>
                    <div class="stat-value">{{ games|length }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Groups</div>
                    <div class="stat-value">{{ groups|length }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Pending Reports</div>
                    <div class="stat-value">{{ pending_reports }}</div>
                </div>
            </div>
            {% if user_permissions.view_token_stats %}
            <div class="card">
                <div class="card-header"><h3 class="card-title">Economy Overview</h3></div>
                <div class="card-body">
                    <div class="stat-card" style="display: inline-block;">
                        <div class="stat-label">Total Tokens in Circulation</div>
                        <div class="stat-value" id="totalTokens">Loading...</div>
                    </div>
                </div>
            </div>
            {% endif %}

        </section>

        <!-- Create User -->
        <section id="create-user-section" class="section">
            <div class="page-header">
                <h1 class="page-title">Create User</h1>
                <p class="page-description">Create a new user account</p>
            </div>
            <div class="card" style="max-width: 500px;">
                <div class="card-body">
                    <form method="POST" action="{{ url_for('create_user') }}">
                        <div class="form-group">
                            <label class="form-label">Username</label>
                            <input type="text" name="username" class="form-input" placeholder="Enter username" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="text" name="password" class="form-input" placeholder="Enter password" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Create User</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Manage Users -->
        <section id="manage-users-section" class="section">
            <div class="page-header">
                <h1 class="page-title">Manage Users</h1>
                <p class="page-description">View and manage all user accounts</p>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="search-box">
                        <input type="text" id="userSearch" placeholder="Search users..." onkeyup="filterUsers()">
                    </div>
                </div>
                <div class="card-body" style="padding: 0;">
                    <table class="data-table">
                        <thead>
                            <tr><th>User</th><th>Role</th><th>Tokens</th><th>Status</th><th>Actions</th></tr>
                        </thead>
                        <tbody id="usersTableBody">
                            {% for username, user_data in users.items() %}
                            <tr data-username="{{ username|lower }}">
                                <td><div style="font-weight: 600;">{{ username }}</div></td>
                                <td>
                                    <span class="badge badge-{% if user_data.role == 'admin' %}danger{% elif user_data.role == 'president' %}purple{% elif user_data.role in ['economy_director', 'pr_director', 'master_moderator'] %}info{% elif user_data.role == 'ambassador' %}success{% else %}gray{% endif %}">
                                        {{ user_data.role }}
                                    </span>
                                </td>
                                <td>üéüÔ∏è {{ user_data.tokens }}</td>
                                <td>
                                    {% if user_data.banned %}<span class="badge badge-danger">Banned</span>
                                    {% else %}<span class="badge badge-success">Active</span>{% endif %}
                                </td>
                                <td>
                                    <div class="flex gap-2">
                                        {% if user_permissions.edit_tokens and username != 'admin' %}
                                        <button class="btn btn-sm btn-secondary" onclick="openEditTokensModal('{{ username }}', {{ user_data.tokens }})">üí∞</button>
                                        {% endif %}
                                        {% if user_permissions.change_passwords and username != 'admin' %}
                                        <button class="btn btn-sm btn-secondary" onclick="openChangePasswordModal('{{ username }}')">üîë</button>
                                        {% endif %}
                                        {% if user_permissions.ban_users and username != 'admin' %}
                                            {% if user_data.banned %}
                                            <button class="btn btn-sm btn-success" onclick="unbanUser('{{ username }}')">Unban</button>
                                            {% else %}
                                            <button class="btn btn-sm btn-danger" onclick="openBanModal('{{ username }}')">Ban</button>
                                            {% endif %}
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Assign Roles -->
        {% if user_permissions.assign_roles %}
        <section id="assign-roles-section" class="section">
            <div class="page-header">
                <h1 class="page-title">Assign Roles</h1>
                <p class="page-description">Assign staff roles. Each specialized role can only be held by one person.</p>
            </div>
            <div class="alert alert-info mb-4">
                <strong>Role Hierarchy:</strong> Admin ‚Üí President ‚Üí Directors ‚Üí Ambassador ‚Üí User
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="items-grid">
                        {% for username, user_data in users.items() %}
                        {% if username != 'admin' %}
                        <div class="item-card">
                            <div class="item-card-header">
                                <div class="item-card-title">{{ username }}</div>
                                <span class="badge badge-{% if user_data.role == 'president' %}purple{% elif user_data.role in ['economy_director', 'pr_director', 'master_moderator'] %}info{% elif user_data.role == 'ambassador' %}success{% else %}gray{% endif %}">
                                    {{ user_data.role }}
                                </span>
                            </div>
                            <div class="item-card-meta">Tokens: üéüÔ∏è {{ user_data.tokens }}</div>
                            <div class="form-group">
                                <select class="form-select" id="role-select-{{ username }}">
                                    <option value="user" {% if user_data.role == 'user' %}selected{% endif %}>User</option>
                                    <option value="ambassador" {% if user_data.role == 'ambassador' %}selected{% endif %}>Ambassador</option>
                                    <option value="master_moderator" {% if user_data.role == 'master_moderator' %}selected{% endif %}>Master Moderator</option>
                                    <option value="pr_director" {% if user_data.role == 'pr_director' %}selected{% endif %}>PR Director</option>
                                    <option value="economy_director" {% if user_data.role == 'economy_director' %}selected{% endif %}>Economy Director</option>
                                    <option value="president" {% if user_data.role == 'president' %}selected{% endif %}>üéñPresident</option>
                                </select>
                            </div>
                            <button class="btn btn-sm btn-primary" onclick="assignRole('{{ username }}')">Update Role</button>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </section>
        {% endif %}

        <!-- Games -->
        {% if user_permissions.manage_games %}
        <section id="games-section" class="section">
            <div class="page-header">
                <h1 class="page-title">Games</h1>
                <p class="page-description">Manage games available on the platform</p>
            </div>
            <div class="card mb-4">
                <div class="card-header"><h3 class="card-title">Add New Game</h3></div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('add_game') }}" enctype="multipart/form-data">
                        <div class="flex gap-3" style="flex-wrap: wrap;">
                            <div class="form-group" style="flex: 1; min-width: 200px;">
                                <label class="form-label">Game Name</label>
                                <input type="text" name="game_name" class="form-input" placeholder="Game name" required>
                            </div>
                            <div class="form-group" style="width: 120px;">
                                <label class="form-label">Price</label>
                                <input type="number" name="price" class="form-input" value="0" min="0">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Background Image URL (optional)</label>
                            <input type="text" name="background_image" class="form-input" placeholder="https://example.com/image.jpg">
                        </div>
                        <div class="form-group">
                            <label class="form-label">HTML Content</label>
                            <textarea name="html_content" class="form-textarea" placeholder="Paste game HTML here"></textarea>
                        </div>
                        <div class="flex gap-3 mb-4" style="flex-wrap: wrap;">
                            <label class="flex items-center gap-2"><input type="checkbox" name="free_for_all" checked> Free for all</label>
                            <label class="flex items-center gap-2"><input type="checkbox" name="is_own_game"> Featured</label>
                            <label class="flex items-center gap-2"><input type="checkbox" name="is_roblox_game"> Roblox</label>
                            <label class="flex items-center gap-2"><input type="checkbox" name="is_minecraft_game"> Minecraft</label>
                            <label class="flex items-center gap-2"><input type="checkbox" name="is_pokemon_game"> Pokemon</label>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Game</button>
                    </form>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">All Games ({{ games|length }})</h3>
                    <div class="search-box"><input type="text" id="gameSearch" placeholder="Search games..." onkeyup="filterGames()"></div>
                </div>
                <div class="card-body">
                    <div class="items-grid" id="gamesGrid">
                        {% for game_id, game in games.items() %}
                        <div class="item-card" data-game-name="{{ game.name|lower }}">
                            <div class="item-card-header">
                                <div class="item-card-title">{{ game.name }}</div>
                                {% if not game.available %}<span class="badge badge-warning">Maintenance</span>
                                {% elif game.free_for_all %}<span class="badge badge-success">Free</span>
                                {% else %}<span class="badge badge-info">üéüÔ∏è {{ game.price }}</span>{% endif %}
                            </div>
                            <div class="item-card-meta">
                                {% if game.is_own_game %}<span class="badge badge-purple">Featured</span>{% endif %}
                                {% if game.is_roblox_game %}<span class="badge badge-info">Roblox</span>{% endif %}
                                {% if game.is_minecraft_game %}<span class="badge badge-success">Minecraft</span>{% endif %}
                                {% if game.is_pokemon_game %}<span class="badge badge-warning">Pokemon</span>{% endif %}
                                {% if game.background_image %}<span class="badge badge-gray">üì∑ BG</span>{% endif %}
                            </div>
                            <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.5rem;">
                                {% if not game.free_for_all %}Price: üéüÔ∏è {{ game.price }}{% else %}Free Game{% endif %}
                            </div>
                            <div class="item-card-actions">
                                <button class="btn btn-sm btn-secondary" onclick="openEditGameModal('{{ game_id }}')">‚úèÔ∏è Edit</button>
                                <form method="POST" action="{{ url_for('toggle_game', game_id=game_id) }}" style="display: inline;">
                                    <button type="submit" class="btn btn-sm {% if game.available %}btn-secondary{% else %}btn-success{% endif %}">
                                        {% if game.available %}Disable{% else %}Enable{% endif %}
                                    </button>
                                </form>
                                <form method="POST" action="{{ url_for('delete_game', game_id=game_id) }}" style="display: inline;" onsubmit="return confirm('Delete?')">
                                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                </form>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </section>
        {% endif %}

        <!-- Announcements -->
        {% if user_permissions.manage_announcements %}
        <section id="announcements-section" class="section">
            <div class="page-header">
                <h1 class="page-title">Announcements</h1>
                <p class="page-description">Create and manage site-wide announcements</p>
            </div>
            <div class="card mb-4">
                <div class="card-header"><h3 class="card-title">Create Announcement</h3></div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('add_announcement') }}">
                        <div class="form-group">
                            <label class="form-label">Announcement Text</label>
                            <textarea name="announcement" class="form-textarea" placeholder="Write your announcement..." required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Post Announcement</button>
                    </form>
                </div>
            </div>
            <div class="card">
                <div class="card-header"><h3 class="card-title">Current Announcements</h3></div>
                <div class="card-body">
                    {% if announcements %}
                        {% for announcement in announcements %}
                        <div class="report-item">
                            <div class="report-content" style="border-left-color: var(--accent-blue);">{{ announcement.text }}</div>
                            <div class="report-meta"><span>Posted: {{ announcement.timestamp }}</span></div>
                            <div class="report-actions">
                                <form method="GET" action="{{ url_for('delete_announcement', index=loop.index0) }}" onsubmit="return confirm('Delete?')">
                                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                </form>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-state"><div class="empty-state-icon">üì¢</div><div class="empty-state-title">No announcements</div></div>
                    {% endif %}
                </div>
            </div>
        </section>
        {% endif %}

        <!-- Groups -->
        {% if user_permissions.manage_groups %}
        <section id="groups-section" class="section">
            <div class="page-header">
                <h1 class="page-title">Groups</h1>
                <p class="page-description">Manage user groups</p>
            </div>
            <div class="card">
                <div class="card-body">
                    {% if groups %}
                    <div class="items-grid">
                        {% for group in groups %}
                        <div class="item-card">
                            <div class="item-card-header">
                                <div class="item-card-title">{{ group.name }}</div>
                                <span class="badge badge-info">{{ group.member_count }} members</span>
                            </div>
                            <div class="item-card-meta">
                                <div>Leader: <strong>{{ group.leader }}</strong></div>
                                <div>Created: {{ group.created_at }}</div>
                            </div>
                            <div class="item-card-actions">
                                <button class="btn btn-sm btn-secondary" onclick="openRenameGroupModal('{{ group.id }}', '{{ group.name }}')">Rename</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteGroup('{{ group.id }}')">Delete</button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="empty-state"><div class="empty-state-icon">üë•</div><div class="empty-state-title">No groups yet</div></div>
                    {% endif %}
                </div>
            </div>
        </section>
        {% endif %}
        <!-- Token Stats -->
        {% if user_permissions.view_token_stats %}
        <section id="token-stats-section" class="section">
            <div class="page-header">
                <h1 class="page-title">Token Statistics</h1>
                <p class="page-description">Monitor the token economy</p>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total in Circulation</div>
                    <div class="stat-value" id="statTotalCirculation">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Created (30 days)</div>
                    <div class="stat-value text-success" id="statTokensCreated">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Destroyed (30 days)</div>
                    <div class="stat-value text-danger" id="statTokensDestroyed">-</div>
                </div>
            </div>
            <div class="card">
                <div class="card-header"><h3 class="card-title">Token Sources (Last 30 Days)</h3></div>
                <div class="card-body" id="tokenSourcesBreakdown">Loading...</div>
            </div>
        </section>
        {% endif %}

        <!-- Casino Stats -->
        {% if user_permissions.view_casino_stats %}
        <section id="casino-stats-section" class="section">
            <div class="page-header">
                <h1 class="page-title">Casino Statistics</h1>
                <p class="page-description">Monitor casino performance and house edge</p>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Coinflip - House Profit</div>
                    <div class="stat-value" id="coinflipProfit">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Tower - House Profit</div>
                    <div class="stat-value" id="towerProfit">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Casino Games</div>
                    <div class="stat-value" id="totalCasinoGames">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">RPS Games</div>
                    <div class="stat-value" id="rpsGamesPlayed">-</div>
                </div>
            </div>
            <div class="card">
                <div class="card-header"><h3 class="card-title">Lottery Performance</h3></div>
                <div class="card-body" id="lotteryStats">Loading...</div>
            </div>
        </section>
        {% endif %}

        <!-- Promo Codes -->
        {% if user_permissions.create_promo_codes %}
        <section id="promo-codes-section" class="section">
            <div class="page-header">
                <h1 class="page-title">Promo Codes</h1>
                <p class="page-description">Create and manage promotional codes</p>
            </div>
            <div class="card mb-4">
                <div class="card-header"><h3 class="card-title">Create New Code</h3></div>
                <div class="card-body">
                    <form id="createCodeForm">
                        <div class="flex gap-3" style="flex-wrap: wrap; align-items: flex-end;">
                            <div class="form-group" style="flex: 1; min-width: 200px; margin-bottom: 0;">
                                <label class="form-label">Code</label>
                                <input type="text" id="newCodeInput" class="form-input" placeholder="e.g., WINTER2024" required style="text-transform: uppercase;">
                            </div>
                            <div class="form-group" style="width: 120px; margin-bottom: 0;">
                                <label class="form-label">Tokens (max 100)</label>
                                <input type="number" id="newCodeAmount" class="form-input" value="10" min="1" max="100" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Create Code</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="card">
                <div class="card-header"><h3 class="card-title">Active Codes</h3></div>
                <div class="card-body" style="padding: 0;">
                    <table class="data-table" id="codesTable">
                        <thead><tr><th>Code</th><th>Tokens</th><th>Created By</th><th>Actions</th></tr></thead>
                        <tbody id="codesTableBody"></tbody>
                    </table>
                </div>
            </div>
        </section>
        {% endif %}

        <!-- Lottery -->
        {% if user_permissions.manage_lottery %}
        <section id="lottery-section" class="section">
            <div class="page-header">
                <h1 class="page-title">Lottery Management</h1>
                <p class="page-description">Create and manage lotteries</p>
            </div>
            {% if lottery_state.active %}
            <div class="alert alert-info mb-4">
                <strong>Active Lottery:</strong> Prize Pool: üéüÔ∏è {{ lottery_state.prize_pool }} | Ticket Price: üéüÔ∏è {{ lottery_state.ticket_price }} | Ends: {{ lottery_state.end_time }}
            </div>
            <div class="flex gap-3 mb-4">
                <button class="btn btn-danger" onclick="endLottery()">End Now</button>
                <button class="btn btn-secondary" onclick="cancelLottery()">Cancel</button>
            </div>
            {% else %}
            <div class="card mb-4">
                <div class="card-header"><h3 class="card-title">Create New Lottery</h3></div>
                <div class="card-body">
                    <form id="createLotteryForm">
                        <div class="flex gap-3" style="flex-wrap: wrap;">
                            <div class="form-group" style="flex: 1; min-width: 150px;">
                                <label class="form-label">Prize Pool üéüÔ∏è</label>
                                <input type="number" id="lotteryPrizePool" class="form-input" placeholder="50" min="1" required>
                            </div>
                            <div class="form-group" style="flex: 1; min-width: 150px;">
                                <label class="form-label">Ticket Price üéüÔ∏è</label>
                                <input type="number" id="lotteryTicketPrice" class="form-input" placeholder="10" min="1" required>
                            </div>
                            <div class="form-group" style="flex: 1; min-width: 150px;">
                                <label class="form-label">Duration (hours)</label>
                                <input type="number" id="lotteryDuration" class="form-input" placeholder="24" min="1" required>
                            </div>
                        </div>
                        <div class="alert alert-warning mt-3">
                            <strong>Profit:</strong> (tickets √ó price) - prize pool = profit
                        </div>
                        <button type="submit" class="btn btn-primary mt-3">Create Lottery</button>
                    </form>
                </div>
            </div>
            {% endif %}
        </section>
        {% endif %}

        <!-- Reported Messages -->
        {% if user_permissions.view_reported_messages %}
        <section id="reports-section" class="section">
            <div class="page-header">
                <h1 class="page-title">Reported Messages</h1>
                <p class="page-description">Review and moderate reported content</p>
            </div>
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Pending Reports</h3>
                    <select class="form-select" style="width: auto;" id="reportStatusFilter" onchange="filterReports()">
                        <option value="pending">Pending</option>
                        <option value="all">All</option>
                        <option value="dismissed">Dismissed</option>
                        <option value="warned">Warned</option>
                        <option value="banned">Banned</option>
                    </select>
                </div>
                <div class="card-body" id="reportsContainer">
                    {% set pending_list = reported_messages|selectattr('status', 'equalto', 'pending')|list %}
                    {% if pending_list %}
                        {% for report in pending_list %}
                        <div class="report-item" data-status="{{ report.status }}">
                            <div class="report-header">
                                <div><strong>From:</strong> {{ report.sender }} <span class="badge badge-warning">{{ report.status }}</span></div>
                                <div class="text-muted" style="font-size: 0.75rem;">#{{ report.id }}</div>
                            </div>
                            <div class="report-content">{{ report.message_content }}</div>
                            <div class="report-meta">
                                <span>Reported by: {{ report.reporter }}</span>
                                <span>Time: {{ report.timestamp }}</span>
                                {% if report.reason %}<span>Reason: {{ report.reason }}</span>{% endif %}
                            </div>
                            {% if report.status == 'pending' %}
                            <div class="report-actions">
                                <button class="btn btn-sm btn-secondary" onclick="openResolveModal('{{ report.id }}', 'dismiss')">Dismiss</button>
                                <button class="btn btn-sm btn-warning" onclick="openResolveModal('{{ report.id }}', 'warn')">Warn</button>
                                <button class="btn btn-sm btn-danger" onclick="openResolveModal('{{ report.id }}', 'ban')">Ban User</button>
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-state"><div class="empty-state-icon">‚úÖ</div><div class="empty-state-title">No pending reports</div></div>
                    {% endif %}
                </div>
            </div>
        </section>
        {% endif %}

        <!-- Feedback -->
        {% if user_permissions.manage_feedback %}
        <section id="feedback-section" class="section">
            <div class="page-header">
                <h1 class="page-title">User Feedback</h1>
                <p class="page-description">Review suggestions and feedback</p>
            </div>
            <div class="card">
                <div class="card-body">
                    {% if feedback %}
                        {% for item in feedback %}
                        <div class="report-item">
                            <div class="report-header">
                                <strong>{{ item.username }}</strong>
                                <span class="text-muted">{{ item.timestamp }}</span>
                            </div>
                            <div class="report-content" style="border-left-color: var(--accent-purple);">{{ item.text }}</div>
                            <div class="report-actions">
                                <form method="GET" action="{{ url_for('delete_feedback', index=loop.index0) }}" onsubmit="return confirm('Delete?')">
                                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                </form>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-state"><div class="empty-state-icon">üí¨</div><div class="empty-state-title">No feedback yet</div></div>
                    {% endif %}
                </div>
            </div>
        </section>
        {% endif %}

        <!-- Paychecks -->
        {% if user_permissions.view_paycheck_status %}
        <section id="paychecks-section" class="section">
            <div class="page-header">
                <h1 class="page-title">Paychecks</h1>
                <p class="page-description">Weekly compensation for staff roles</p>
            </div>
            <div class="alert alert-info mb-4">
                <strong>Pay Schedule:</strong> Paychecks processed every Monday. President: 100üéüÔ∏è | Directors: 50üéüÔ∏è
            </div>
            {% if user_permissions.approve_paychecks %}
            <div class="flex gap-3 mb-4">
                <button class="btn btn-primary" onclick="generatePaychecks()">Generate Weekly Paychecks</button>
            </div>
            <div class="card mb-4">
                <div class="card-header"><h3 class="card-title">Pending Approvals</h3></div>
                <div class="card-body" id="pendingPaychecks">
                    <div class="empty-state"><div class="empty-state-icon">üí∞</div><div class="empty-state-title">Loading...</div></div>
                </div>
            </div>
            {% endif %}
            <div class="card">
                <div class="card-header"><h3 class="card-title">Paycheck History</h3></div>
                <div class="card-body" id="paycheckHistory"></div>
            </div>
        </section>
        {% endif %}

        <!-- Action Logs -->
        {% if user_permissions.view_action_logs %}
        <section id="action-logs-section" class="section">
            <div class="page-header">
                <h1 class="page-title">Action Logs</h1>
                <p class="page-description">Track all staff actions</p>
            </div>
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Recent Actions</h3>
                    <select class="form-select" style="width: auto;" id="actionTypeFilter" onchange="loadActionLogs()">
                        <option value="all">All Actions</option>
                    </select>
                </div>
                <div class="card-body" id="actionLogsContainer">
                    <div class="empty-state"><div class="empty-state-icon">üìù</div><div class="empty-state-title">Loading...</div></div>
                </div>
            </div>
        </section>
        {% endif %}

        <!-- Maintenance -->
        {% if user_permissions.maintenance_mode %}
        <section id="maintenance-section" class="section">
            <div class="page-header">
                <h1 class="page-title">Maintenance Mode</h1>
                <p class="page-description">Control site accessibility</p>
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 style="font-weight: 600; margin-bottom: 0.25rem;">Maintenance Mode</h3>
                            <p class="text-muted" style="font-size: 0.875rem;">When enabled, only staff can access the site</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="maintenanceToggle" {% if maintenance_mode.enabled %}checked{% endif %} onchange="toggleMaintenance()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <hr style="border: none; border-top: 1px solid var(--border-color); margin: 1.5rem 0;">
                    <div class="flex gap-3">
                        <button class="btn btn-secondary" onclick="resetCookie()">ü•† Reset Cookie</button>
                        <button class="btn btn-secondary" onclick="markAllAsRead()">‚úì Mark All Read</button>
                        <button class="btn btn-danger" onclick="clearLoungeHistory()">üóëÔ∏è Clear Lounge</button>
                    </div>
                </div>
            </div>
        </section>
        {% endif %}
    </main>
    <!-- Modals -->
    <!-- Edit Tokens Modal -->
    <div class="modal-overlay" id="editTokensModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit Tokens</h3>
                <button class="modal-close" onclick="closeModal('editTokensModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">User: <span id="editTokensUsername"></span></label>
                </div>
                <div class="form-group">
                    <label class="form-label">New Token Amount</label>
                    <input type="number" id="editTokensAmount" class="form-input" min="0" required>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('editTokensModal')">Cancel</button>
                <button class="btn btn-primary" onclick="submitEditTokens()">Save</button>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal-overlay" id="changePasswordModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Change Password</h3>
                <button class="modal-close" onclick="closeModal('changePasswordModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">User: <span id="changePasswordUsername"></span></label>
                </div>
                <div class="form-group">
                    <label class="form-label">New Password</label>
                    <input type="text" id="newPasswordInput" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Reason</label>
                    <input type="text" id="passwordReason" class="form-input" placeholder="Why are you changing this?" required>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('changePasswordModal')">Cancel</button>
                <button class="btn btn-primary" onclick="submitChangePassword()">Change</button>
            </div>
        </div>
    </div>

    <!-- Ban User Modal -->
    <div class="modal-overlay" id="banUserModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Ban User</h3>
                <button class="modal-close" onclick="closeModal('banUserModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="alert alert-danger">You are about to ban <strong id="banUsername"></strong>.</div>
                <form id="banUserForm" method="POST" action="{{ url_for('ban_user') }}">
                    <input type="hidden" name="username" id="banUsernameInput">
                    <div class="form-group">
                        <label class="form-label">Ban Reason (required)</label>
                        <textarea name="reason" class="form-textarea" placeholder="Explain why..." required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('banUserModal')">Cancel</button>
                <button class="btn btn-danger" onclick="document.getElementById('banUserForm').submit()">Confirm Ban</button>
            </div>
        </div>
    </div>

    <!-- Resolve Report Modal -->
    <div class="modal-overlay" id="resolveReportModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="resolveModalTitle">Resolve Report</h3>
                <button class="modal-close" onclick="closeModal('resolveReportModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="resolveReportId">
                <input type="hidden" id="resolveAction">
                <div class="form-group">
                    <label class="form-label">Reason (required)</label>
                    <textarea id="resolveReason" class="form-textarea" placeholder="Explain your decision..." required></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('resolveReportModal')">Cancel</button>
                <button class="btn btn-primary" onclick="submitResolve()">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Rename Group Modal -->
    <div class="modal-overlay" id="renameGroupModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Rename Group</h3>
                <button class="modal-close" onclick="closeModal('renameGroupModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="renameGroupId">
                <div class="form-group">
                    <label class="form-label">New Name</label>
                    <input type="text" id="renameGroupName" class="form-input" maxlength="30" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Reason</label>
                    <input type="text" id="renameGroupReason" class="form-input" placeholder="Why rename?" required>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('renameGroupModal')">Cancel</button>
                <button class="btn btn-primary" onclick="submitRenameGroup()">Rename</button>
            </div>
        </div>
    </div>

    <!-- Assign Role Modal -->
    <div class="modal-overlay" id="assignRoleModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Confirm Role Change</h3>
                <button class="modal-close" onclick="closeModal('assignRoleModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="assignRoleUsername">
                <input type="hidden" id="assignRoleValue">
                <div class="alert alert-warning">
                    Changing <strong id="assignRoleUserDisplay"></strong>'s role to <strong id="assignRoleDisplay"></strong>.
                </div>
                <div class="form-group">
                    <label class="form-label">Reason (required)</label>
                    <textarea id="assignRoleReason" class="form-textarea" placeholder="Why change this role?" required></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('assignRoleModal')">Cancel</button>
                <button class="btn btn-primary" onclick="submitAssignRole()">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Approve Paycheck Modal -->
    <div class="modal-overlay" id="approvePaycheckModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Approve Paycheck</h3>
                <button class="modal-close" onclick="closeModal('approvePaycheckModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="approvePaycheckId">
                <div class="form-group">
                    <label class="form-label">Note to Recipient</label>
                    <textarea id="paycheckNoteRecipient" class="form-textarea" placeholder="Message for the staff member..." required></textarea>
                </div>
                {% if user_role == 'president' %}
                <div class="form-group">
                    <label class="form-label">Feedback to Admin</label>
                    <textarea id="paycheckNoteAdmin" class="form-textarea" placeholder="Your assessment..." required></textarea>
                </div>
                {% endif %}
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('approvePaycheckModal')">Cancel</button>
                <button class="btn btn-success" onclick="submitApprovePaycheck()">Approve & Pay</button>
            </div>
        </div>
    </div>

    <!-- Adjust Paycheck Modal -->
    <div class="modal-overlay" id="adjustPaycheckModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Adjust Paycheck</h3>
                <button class="modal-close" onclick="closeModal('adjustPaycheckModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="adjustPaycheckId">
                <div class="form-group">
                    <label class="form-label">New Amount üéüÔ∏è</label>
                    <select id="adjustPaycheckAmount" class="form-select">
                        <option value="20">20 üéüÔ∏è</option>
                        <option value="50">50 üéüÔ∏è</option>
                        <option value="60">60 üéüÔ∏è</option>
                        <option value="70">70 üéüÔ∏è</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Reason for Adjustment</label>
                    <textarea id="adjustPaycheckReason" class="form-textarea" placeholder="Why adjust?" required></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('adjustPaycheckModal')">Cancel</button>
                <button class="btn btn-primary" onclick="submitAdjustPaycheck()">Adjust</button>
            </div>
        </div>
    </div>

    <!-- Edit Game Modal -->
    <div class="modal-overlay" id="editGameModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit Game</h3>
                <button class="modal-close" onclick="closeModal('editGameModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editGameId">
                <div class="form-group">
                    <label class="form-label">Game Name</label>
                    <input type="text" id="editGameName" class="form-input" readonly style="background: var(--bg-secondary);">
                </div>
                <div class="form-group">
                    <label class="form-label">Price (Tokens)</label>
                    <input type="number" id="editGamePrice" class="form-input" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Background Image URL</label>
                    <input type="text" id="editGameBackground" class="form-input" placeholder="https://example.com/image.jpg">
                </div>
                <div class="form-group">
                    <label class="flex items-center gap-2">
                        <input type="checkbox" id="editGameFeatured">
                        <span>Featured Game</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('editGameModal')">Cancel</button>
                <button class="btn btn-primary" onclick="submitEditGame()">Save Changes</button>
            </div>
        </div>
    </div>

    <script>
        // Section Navigation
        function showSection(sectionId, navElement) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId + '-section').classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if (navElement) navElement.classList.add('active');
        }

        // Modal Functions
        function openModal(modalId) { document.getElementById(modalId).classList.add('active'); }
        function closeModal(modalId) { document.getElementById(modalId).classList.remove('active'); }
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(modal.id); });
        });

        // Filter Functions
        function filterUsers() {
            const search = document.getElementById('userSearch').value.toLowerCase();
            document.querySelectorAll('#usersTableBody tr').forEach(row => {
                const username = row.getAttribute('data-username');
                row.style.display = username.includes(search) ? '' : 'none';
            });
        }
        function filterGames() {
            const search = document.getElementById('gameSearch').value.toLowerCase();
            document.querySelectorAll('#gamesGrid .item-card').forEach(card => {
                const name = card.getAttribute('data-game-name');
                card.style.display = name.includes(search) ? '' : 'none';
            });
        }

        // Edit Tokens
        let editTokensTarget = '';
        function openEditTokensModal(username, currentTokens) {
            editTokensTarget = username;
            document.getElementById('editTokensUsername').textContent = username;
            document.getElementById('editTokensAmount').value = currentTokens;
            openModal('editTokensModal');
        }
        function submitEditTokens() {
            const amount = document.getElementById('editTokensAmount').value;
            window.location.href = `/panel/edit_token/${editTokensTarget}/${amount}`;
        }

        // Change Password
        let passwordTarget = '';
        function openChangePasswordModal(username) {
            passwordTarget = username;
            document.getElementById('changePasswordUsername').textContent = username;
            openModal('changePasswordModal');
        }
        function submitChangePassword() {
            const password = document.getElementById('newPasswordInput').value;
            const reason = document.getElementById('passwordReason').value;
            if (!reason) { alert('Reason required'); return; }
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = `/panel/change_password/${passwordTarget}`;
            const pwInput = document.createElement('input');
            pwInput.name = 'new_password';
            pwInput.value = password;
            form.appendChild(pwInput);
            document.body.appendChild(form);
            form.submit();
        }

        // Ban User
        function openBanModal(username) {
            document.getElementById('banUsername').textContent = username;
            document.getElementById('banUsernameInput').value = username;
            openModal('banUserModal');
        }
        function unbanUser(username) {
            if (confirm('Unban ' + username + '?')) {
                window.location.href = `/panel/unban_user/${username}`;
            }
        }

        // Resolve Report
        let resolveReportId = null;
        let resolveActionType = '';
        function openResolveModal(reportId, action) {
            resolveReportId = reportId;
            resolveActionType = action;
            document.getElementById('resolveReportId').value = reportId;
            document.getElementById('resolveAction').value = action;
            document.getElementById('resolveModalTitle').textContent =
                action === 'dismiss' ? 'Dismiss Report' : action === 'warn' ? 'Warn User' : 'Ban User';
            document.getElementById('resolveReason').value = '';
            openModal('resolveReportModal');
        }
        function submitResolve() {
            const reason = document.getElementById('resolveReason').value;
            if (!reason) { alert('Reason required'); return; }
            fetch(`/api/resolve_report/${resolveReportId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: resolveActionType, reason: reason })
            }).then(r => r.json()).then(data => {
                if (data.success) location.reload();
                else alert(data.error || 'Error');
            });
        }

        // Rename Group
        function openRenameGroupModal(groupId, currentName) {
            document.getElementById('renameGroupId').value = groupId;
            document.getElementById('renameGroupName').value = currentName;
            openModal('renameGroupModal');
        }
        function submitRenameGroup() {
            const groupId = document.getElementById('renameGroupId').value;
            const newName = document.getElementById('renameGroupName').value;
            const reason = document.getElementById('renameGroupReason').value;
            if (!reason) { alert('Reason required'); return; }
            fetch(`/api/admin/group/${groupId}/rename`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: newName, reason: reason })
            }).then(r => r.json()).then(data => {
                if (data.success) location.reload();
                else alert(data.error || 'Error');
            });
        }
        function deleteGroup(groupId) {
            const reason = prompt('Reason for deleting:');
            if (!reason) return;
            if (confirm('Delete this group?')) {
                fetch(`/api/admin/group/${groupId}/delete`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ reason: reason })
                }).then(r => r.json()).then(data => {
                    if (data.success) location.reload();
                    else alert(data.error || 'Error');
                });
            }
        }

        // Assign Role
        function assignRole(username) {
            const newRole = document.getElementById('role-select-' + username).value;
            document.getElementById('assignRoleUsername').value = username;
            document.getElementById('assignRoleValue').value = newRole;
            document.getElementById('assignRoleUserDisplay').textContent = username;
            document.getElementById('assignRoleDisplay').textContent = newRole;
            document.getElementById('assignRoleReason').value = '';
            openModal('assignRoleModal');
        }
        function submitAssignRole() {
            const username = document.getElementById('assignRoleUsername').value;
            const role = document.getElementById('assignRoleValue').value;
            const reason = document.getElementById('assignRoleReason').value;
            if (!reason) { alert('Reason required'); return; }
            fetch(`/api/assign_role/${username}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ role: role, reason: reason })
            }).then(r => r.json()).then(data => {
                if (data.success) { closeModal('assignRoleModal'); location.reload(); }
                else alert(data.error || 'Error');
            });
        }

        // Promo Codes
        document.getElementById('createCodeForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            const code = document.getElementById('newCodeInput').value.toUpperCase();
            const amount = document.getElementById('newCodeAmount').value;
            const formData = new FormData();
            formData.append('code', code);
            formData.append('amount', amount);
            fetch('/api/create_code', { method: 'POST', body: formData })
            .then(r => r.json()).then(data => {
                if (data.success) location.reload();
                else alert(data.error || 'Error');
            });
        });
        function loadCodes() {
            fetch('/api/get_codes').then(r => r.json()).then(data => {
                const tbody = document.getElementById('codesTableBody');
                if (!tbody) return;
                if (!data.codes || data.codes.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:var(--text-muted);">No codes</td></tr>';
                    return;
                }
                tbody.innerHTML = data.codes.map(c => `
                    <tr>
                        <td><code style="background:var(--bg-tertiary);padding:0.25rem 0.5rem;border-radius:4px;">${c.code}</code></td>
                        <td>üéüÔ∏è ${c.tokens}</td>
                        <td>${c.created_by}</td>
                        <td><button class="btn btn-sm btn-danger" onclick="deleteCode('${c.code}')">Delete</button></td>
                    </tr>
                `).join('');
            });
        }
        function deleteCode(code) {
            if (confirm('Delete ' + code + '?')) {
                fetch('/api/delete_code/' + code, { method: 'POST' })
                .then(r => r.json()).then(data => { if (data.success) loadCodes(); else alert('Error'); });
            }
        }

        // Lottery
        document.getElementById('createLotteryForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            const prizePool = document.getElementById('lotteryPrizePool').value;
            const ticketPrice = document.getElementById('lotteryTicketPrice').value;
            const duration = document.getElementById('lotteryDuration').value;
            fetch('/api/lottery_create', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    prize_pool: parseInt(prizePool),
                    ticket_price: parseInt(ticketPrice),
                    duration_hours: parseInt(duration)
                })
            }).then(r => r.json()).then(data => {
                if (data.success) location.reload();
                else alert(data.error || 'Error');
            });
        });
        function endLottery() {
            if (confirm('End lottery now?')) {
                fetch('/api/lottery_end', { method: 'POST' }).then(r => r.json()).then(data => {
                    if (data.success) location.reload(); else alert(data.error || 'Error');
                });
            }
        }
        function cancelLottery() {
            if (confirm('Cancel lottery?')) {
                fetch('/api/lottery_cancel', { method: 'POST' }).then(r => r.json()).then(data => {
                    if (data.success) location.reload(); else alert(data.error || 'Error');
                });
            }
        }

        // Paychecks
        function loadPaychecks() {
            fetch('/api/paychecks').then(r => r.json()).then(data => {
                if (data.success) {
                    renderPendingPaychecks(data.pending || []);
                    renderPaycheckHistory(data.history || []);
                }
            }).catch(() => {});
        }
        function renderPendingPaychecks(pending) {
            const container = document.getElementById('pendingPaychecks');
            if (!container) return;
            if (pending.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚úÖ</div><div class="empty-state-title">No pending</div></div>';
                return;
            }
            container.innerHTML = pending.map(p => {
                const adj = p.final_amount - p.base_amount;
                return `
                    <div class="paycheck-card">
                        <div class="paycheck-header">
                            <div><strong>${p.username}</strong> <span class="badge badge-info">${p.role}</span></div>
                            <div class="paycheck-amount">üéüÔ∏è ${p.final_amount}${adj !== 0 ? ` <span class="paycheck-adjustment ${adj > 0 ? 'positive' : 'negative'}">${adj > 0 ? '+' : ''}${adj}</span>` : ''}</div>
                        </div>
                        ${p.adjustment_reason ? `<div class="text-muted" style="font-size:0.8rem;margin-bottom:0.5rem;">Adjustment: ${p.adjustment_reason}</div>` : ''}
                        <div class="flex gap-2">
                            <button class="btn btn-sm btn-secondary" onclick="openAdjustPaycheckModal('${p.id}', ${p.base_amount})">Adjust</button>
                            <button class="btn btn-sm btn-success" onclick="openApprovePaycheckModal('${p.id}')">Approve</button>
                        </div>
                    </div>`;
            }).join('');
        }
        function renderPaycheckHistory(history) {
            const container = document.getElementById('paycheckHistory');
            if (!container) return;
            if (history.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìã</div><div class="empty-state-title">No history</div></div>';
                return;
            }
            container.innerHTML = `<table class="data-table"><thead><tr><th>User</th><th>Role</th><th>Amount</th><th>Approved By</th><th>Date</th></tr></thead><tbody>
                ${history.map(p => `<tr><td>${p.username}</td><td><span class="badge badge-gray">${p.role}</span></td><td>üéüÔ∏è ${p.final_amount}</td><td>${p.approved_by || '-'}</td><td>${p.approved_at || '-'}</td></tr>`).join('')}
            </tbody></table>`;
        }
        function generatePaychecks() {
            if (confirm('Generate paychecks?')) {
                fetch('/api/generate_paychecks', { method: 'POST' }).then(r => r.json()).then(data => {
                    if (data.success) { alert('Generated: ' + data.count); loadPaychecks(); }
                    else alert(data.error || 'Error');
                });
            }
        }
        function openAdjustPaycheckModal(paycheckId, baseAmount) {
            document.getElementById('adjustPaycheckId').value = paycheckId;
            document.getElementById('adjustPaycheckAmount').value = baseAmount;
            document.getElementById('adjustPaycheckReason').value = '';
            openModal('adjustPaycheckModal');
        }
        function submitAdjustPaycheck() {
            const id = document.getElementById('adjustPaycheckId').value;
            const amount = document.getElementById('adjustPaycheckAmount').value;
            const reason = document.getElementById('adjustPaycheckReason').value;
            if (!reason) { alert('Reason required'); return; }
            fetch(`/api/adjust_paycheck/${id}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ amount: parseInt(amount), reason: reason })
            }).then(r => r.json()).then(data => {
                if (data.success) { closeModal('adjustPaycheckModal'); loadPaychecks(); }
                else alert(data.error || 'Error');
            });
        }
        function openApprovePaycheckModal(paycheckId) {
            document.getElementById('approvePaycheckId').value = paycheckId;
            document.getElementById('paycheckNoteRecipient').value = '';
            const adminNote = document.getElementById('paycheckNoteAdmin');
            if (adminNote) adminNote.value = '';
            openModal('approvePaycheckModal');
        }
        function submitApprovePaycheck() {
            const id = document.getElementById('approvePaycheckId').value;
            const note = document.getElementById('paycheckNoteRecipient').value;
            const adminNote = document.getElementById('paycheckNoteAdmin')?.value || '';
            if (!note) { alert('Note required'); return; }
            fetch(`/api/approve_paycheck/${id}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ president_note: note, admin_feedback: adminNote })
            }).then(r => r.json()).then(data => {
                if (data.success) { closeModal('approvePaycheckModal'); loadPaychecks(); alert('Approved!'); }
                else alert(data.error || 'Error');
            });
        }

        // Action Logs
        function loadActionLogs() {
            const filter = document.getElementById('actionTypeFilter')?.value || 'all';
            fetch(`/api/action_logs?action_type=${filter}&limit=100`)
            .then(r => r.json()).then(data => {
                if (data.success) {
                    renderActionLogs(data.logs);
                    populateActionTypeFilter(data.action_types);
                }
            }).catch(() => {});
        }
        function renderActionLogs(logs) {
            const container = document.getElementById('actionLogsContainer');
            if (!container) return;
            if (logs.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìù</div><div class="empty-state-title">No logs</div></div>';
                return;
            }
            container.innerHTML = logs.map(log => `
                <div class="log-item">
                    <div class="log-icon">${getActionIcon(log.action_type)}</div>
                    <div class="log-content">
                        <div class="log-action"><strong>${log.actor}</strong> ${formatActionType(log.action_type)}${log.target ? ` ‚Üí <strong>${log.target}</strong>` : ''}</div>
                        <div class="log-time">${log.timestamp}</div>
                        ${log.reason ? `<div class="log-reason">Reason: ${log.reason}</div>` : ''}
                    </div>
                </div>`).join('');
        }
        function populateActionTypeFilter(types) {
            const select = document.getElementById('actionTypeFilter');
            if (!select || select.options.length > 1) return;
            types.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = formatActionType(type);
                select.appendChild(option);
            });
        }
        function getActionIcon(actionType) {
            const icons = { 'ban_user': 'üö´', 'assign_role': 'üéñÔ∏è', 'approve_paycheck': 'üí∞', 'adjust_paycheck': '‚úèÔ∏è',
                'resolve_report_dismiss': '‚úÖ', 'resolve_report_warn': '‚ö†Ô∏è', 'resolve_report_ban': 'üî®',
                'create_announcement': 'üì¢', 'delete_announcement': 'üóëÔ∏è', 'create_lottery': 'üéüÔ∏è', 'end_lottery': 'üèÜ' };
            return icons[actionType] || 'üìã';
        }
        function formatActionType(type) { return type.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()); }

        // Token Stats
        function loadTokenStats() {
            fetch('/api/token_statistics').then(r => r.json()).then(data => {
                if (data.success) {
                    document.getElementById('statTotalCirculation').textContent = 'üéüÔ∏è ' + data.total_circulation.toLocaleString();
                    document.getElementById('statTokensCreated').textContent = '+' + data.created_total.toLocaleString();
                    document.getElementById('statTokensDestroyed').textContent = '-' + data.destroyed_total.toLocaleString();
                    renderTokenSources(data.created_by_source, data.destroyed_by_source);
                }
            }).catch(() => {});
        }
        function renderTokenSources(created, destroyed) {
            const container = document.getElementById('tokenSourcesBreakdown');
            if (!container) return;
            let html = '<div class="flex gap-3" style="flex-wrap:wrap;">';
            html += '<div style="flex:1;min-width:250px;"><h4 style="margin-bottom:0.75rem;color:var(--accent-green);">Created</h4>';
            for (const [source, amount] of Object.entries(created)) {
                html += `<div class="flex justify-between" style="padding:0.5rem 0;border-bottom:1px solid var(--border-color);"><span>${formatActionType(source)}</span><span class="text-success">+${amount.toLocaleString()}</span></div>`;
            }
            html += '</div><div style="flex:1;min-width:250px;"><h4 style="margin-bottom:0.75rem;color:var(--accent-red);">Destroyed</h4>';
            for (const [source, amount] of Object.entries(destroyed)) {
                html += `<div class="flex justify-between" style="padding:0.5rem 0;border-bottom:1px solid var(--border-color);"><span>${formatActionType(source)}</span><span class="text-danger">-${amount.toLocaleString()}</span></div>`;
            }
            html += '</div></div>';
            container.innerHTML = html;
        }

        // Casino Stats
        function loadCasinoStats() {
            fetch('/api/casino_statistics').then(r => r.json()).then(data => {
                if (data.success) {
                    const coinflipProfit = data.coinflip?.house_profit || 0;
                    const towerProfit = data.tower?.house_profit || 0;
                    document.getElementById('coinflipProfit').textContent = (coinflipProfit >= 0 ? '+' : '') + coinflipProfit.toLocaleString() + ' üéüÔ∏è';
                    document.getElementById('coinflipProfit').className = 'stat-value ' + (coinflipProfit >= 0 ? 'text-success' : 'text-danger');
                    document.getElementById('towerProfit').textContent = (towerProfit >= 0 ? '+' : '') + towerProfit.toLocaleString() + ' üéüÔ∏è';
                    document.getElementById('towerProfit').className = 'stat-value ' + (towerProfit >= 0 ? 'text-success' : 'text-danger');
                    document.getElementById('totalCasinoGames').textContent = ((data.coinflip?.total_games || 0) + (data.tower?.total_games || 0)).toLocaleString();
                    document.getElementById('rpsGamesPlayed').textContent = (data.rps?.total_games || 0).toLocaleString();
                    renderLotteryStats(data.lottery_history || []);
                }
            }).catch(() => {});
        }
        function renderLotteryStats(history) {
            const container = document.getElementById('lotteryStats');
            if (!container) return;
            if (history.length === 0) { container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üé∞</div><div class="empty-state-title">No lottery history</div></div>'; return; }
            let totalProfit = 0;
            let html = '<table class="data-table"><thead><tr><th>Date</th><th>Prize Pool</th><th>Tickets</th><th>Revenue</th><th>Profit</th></tr></thead><tbody>';
            history.slice(0, 20).forEach(l => {
                const profit = l.profit || 0;
                totalProfit += profit;
                html += `<tr><td>${l.ended_at || '-'}</td><td>üéüÔ∏è ${l.prize_pool}</td><td>${l.tickets_sold || 0}</td><td>üéüÔ∏è ${l.revenue || 0}</td><td class="${profit >= 0 ? 'text-success' : 'text-danger'}">${profit >= 0 ? '+' : ''}${profit}</td></tr>`;
            });
            html += `</tbody></table><div class="mt-3"><strong>Total:</strong> <span class="${totalProfit >= 0 ? 'text-success' : 'text-danger'}">${totalProfit >= 0 ? '+' : ''}${totalProfit} üéüÔ∏è</span></div>`;
            container.innerHTML = html;
        }

        // Maintenance
        function toggleMaintenance() {
            fetch('/api/toggle_maintenance', { method: 'POST' }).then(r => r.json()).then(data => {
                if (!data.success) { alert('Error'); document.getElementById('maintenanceToggle').checked = !document.getElementById('maintenanceToggle').checked; }
            });
        }
        function resetCookie() {
            if (confirm('Reset cookie?')) {
                fetch('/api/reset_cookie', { method: 'POST' }).then(r => r.json()).then(data => {
                    if (data.success) alert('Reset!'); else alert('Error');
                });
            }
        }
        function markAllAsRead() {
            if (confirm('Mark all as read?')) {
                fetch('/api/mark_all_as_read', { method: 'POST' }).then(r => r.json()).then(data => {
                    if (data.success) alert('Done!'); else alert('Error');
                });
            }
        }
        function clearLoungeHistory() {
            if (confirm('Clear lounge?')) {
                fetch('/lounge/clear_history', { method: 'POST' }).then(r => r.json()).then(data => {
                    if (data.success) alert('Cleared!'); else alert('Error');
                });
            }
        }
        function clearLoginNotifications() {
            fetch('/api/clear_login_notifications', { method: 'POST' }).then(r => r.json()).then(data => {
                if (data.success) location.reload();
            });
        }

        // Dashboard Stats
        function loadDashboardStats() {
            fetch('/api/token_statistics').then(r => r.json()).then(data => {
                if (data.success) {
                    const el = document.getElementById('totalTokens');
                    if (el) el.textContent = 'üéüÔ∏è ' + data.total_circulation.toLocaleString();
                }
            }).catch(() => {
                const el = document.getElementById('totalTokens');
                if (el) el.textContent = '-';
            });
        }

        // Edit Game
        function openEditGameModal(gameId) {
            // Get game data from the games object passed from backend
            const games = {{ games|tojson }};
            const game = games[gameId];

            if (!game) {
                alert('Game not found');
                return;
            }

            document.getElementById('editGameId').value = gameId;
            document.getElementById('editGameName').value = game.name;
            document.getElementById('editGamePrice').value = game.price || 0;
            document.getElementById('editGameBackground').value = game.background_image || '';
            document.getElementById('editGameFeatured').checked = game.is_own_game || false;

            openModal('editGameModal');
        }

        function submitEditGame() {
            const gameId = document.getElementById('editGameId').value;
            const price = parseInt(document.getElementById('editGamePrice').value);
            const background = document.getElementById('editGameBackground').value.trim();
            const featured = document.getElementById('editGameFeatured').checked;

            if (price < 0) {
                alert('Price cannot be negative');
                return;
            }

            fetch(`/api/update_game_details/${gameId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    price: price,
                    background_image: background,
                    is_own_game: featured
                })
            }).then(r => r.json()).then(data => {
                if (data.success) {
                    closeModal('editGameModal');
                    location.reload();
                } else {
                    alert(data.error || 'Error updating game');
                }
            }).catch(err => {
                alert('Error: ' + err.message);
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardStats();
            if (document.getElementById('codesTableBody')) loadCodes();
            if (document.getElementById('pendingPaychecks')) loadPaychecks();
            if (document.getElementById('actionLogsContainer')) loadActionLogs();
            if (document.getElementById('statTotalCirculation')) loadTokenStats();
            if (document.getElementById('coinflipProfit')) loadCasinoStats();
        });
    </script>
</body>
</html>